/* src/app/globals.css */
@import "tailwindcss";

/* ---------------- Global theme tokens ---------------- */
:root{
  --background:#ffffff;
  --foreground:#171717;

  /* Layout tokens */
  --page-max:1200px;
  --page-gutter:clamp(16px,4vw,28px);
  --article-max:clamp(680px,68ch,840px);
  --reader-cap:840px;
  --header-media-max:600px;
  --rim:clamp(0px,calc((100vw - var(--reader-cap))/2),200px);

  --section-gap-sm:clamp(16px,4vw,24px);
  --section-gap:clamp(24px,5vw,48px);
  --section-gap-lg:clamp(32px,6vw,64px);

  --radius:.75rem;
}

:root[data-theme="light"]{
  --background:#ffffff;
  --foreground:#171717;
}

:root[data-theme="dark"]{
  --background:#0a0a0a;
  --foreground:#ededed;
}

:root[data-theme="sepia"]{
  --background:#f4ecd9;
  --foreground:#2f2417;
}

@media (prefers-color-scheme:dark){
  :root:not([data-theme]){ --background:#0a0a0a; --foreground:#ededed; }
}

:root{ color-scheme:light; }
:root.dark,
:root[data-theme="dark"]{ color-scheme:dark; }

/* ---------------- base & overflow safety ---------------- */
*,
*::before,
*::after { box-sizing: border-box; }

html{ text-size-adjust:100%; }

html, body{
  max-width:100%;
  overflow-x: clip;
}
@supports not (overflow-x: clip) {
  html, body{ overflow-x:hidden; }
}

body{
  background:var(--background);
  color:var(--foreground);
  -webkit-font-smoothing:antialiased;
  text-rendering:optimizeLegibility;
  min-height:100svh;
}

/* ---------------- Containers & rhythm ---------------- */
.ws-container{
  margin-inline:auto;
  width:100%;
  max-width:min(var(--page-max,1200px),100%);
  padding-inline:var(--page-gutter);
  overflow-x: clip;
}
@supports(padding:max(0px)){
  .ws-container{
    padding-left:max(var(--page-gutter),env(safe-area-inset-left));
    padding-right:max(var(--page-gutter),env(safe-area-inset-right));
  }
}
.ws-article{
  display:block; box-sizing:border-box;
  max-width:var(--article-max);
  width:100%;
  margin-inline:auto;
  overflow-x: clip;
}

/* Bleed (desktop only). On mobile we neutralize it completely. */
.bleed{
  margin-left:calc(-1*var(--page-gutter));
  margin-right:calc(-1*var(--page-gutter));
  width:calc(100% + 2*var(--page-gutter));
}
@supports(padding:max(0px)){
  .bleed{
    margin-left:calc(-1*max(var(--page-gutter),env(safe-area-inset-left)));
    margin-right:calc(-1*max(var(--page-gutter),env(safe-area-inset-right)));
    width:calc(100% + max(var(--page-gutter),env(safe-area-inset-left)) + max(var(--page-gutter),env(safe-area-inset-right)));
  }
}
@media (max-width:768px){
  .bleed{
    margin-left:0 !important;
    margin-right:0 !important;
    width:100% !important;
  }
}

/* Simple vertical stack */
.stack > * + *{ margin-block-start:var(--section-gap); }
.stack--sm{ --section-gap:var(--section-gap-sm); }
.stack--lg{ --section-gap:var(--section-gap-lg); }

/* Small readability helpers */
h1,h2{ text-wrap:balance; }
p,li{ text-wrap:pretty; }

/* Reduced motion */
@media (prefers-reduced-motion:reduce){
  *{
    animation-duration:.01ms !important;
    animation-iteration-count:1 !important;
    transition-duration:.01ms !important;
    scroll-behavior:auto !important;
  }
}

/* ---------------- Theme-aware autofill ---------------- */
@media (prefers-color-scheme:dark){
  input:-webkit-autofill,
  input:-webkit-autofill:hover,
  input:-webkit-autofill:focus,
  textarea:-webkit-autofill,
  select:-webkit-autofill{
    -webkit-text-fill-color:#fff !important;
    -webkit-box-shadow:0 0 0 1000px #000 inset !important;
    box-shadow:0 0 0 1000px #000 inset !important;
    caret-color:#fff !important;
    transition:background-color 9999s ease-in-out 0s;
  }
}
@media (prefers-color-scheme:light){
  input:-webkit-autofill,
  input:-webkit-autofill:hover,
  input:-webkit-autofill:focus,
  textarea:-webkit-autofill,
  select:-webkit-autofill{
    -webkit-text-fill-color:#111 !important;
    -webkit-box-shadow:0 0 0 1000px #fff inset !important;
    box-shadow:0 0 0 1000px #fff inset !important;
    caret-color:#111 !important;
    transition:background-color 9999s ease-in-out 0s;
  }
}

/* ===================================================== */
/* Article body image sizing & floats (global, on purpose)*/
/* ===================================================== */

/* Clear floats inside .wysiwyg */
.wysiwyg::after{ content:""; display:table; clear:both; }

/* keep any rogue child from pushing width */
.wysiwyg{ overflow-x: clip; }
@supports not (overflow-x: clip) { .wysiwyg{ overflow-x:hidden; } }

/* Media never exceed their column */
.wysiwyg img, .wysiwyg svg, .wysiwyg video, .wysiwyg iframe, .wysiwyg table{
  max-inline-size:100%;
  height:auto;
}

/* Center NON-floated images at 50% on desktop */
.wysiwyg :is(img,a>img,figure>img):not(
  .alignleft,.alignright,.ws-float-left,.ws-float-right,
  [style*="float:left"],[style*="float: left"],
  [style*="float:right"],[style*="float: right"]
){
  display:block !important;
  margin-inline:auto !important;
  width:50% !important; max-width:50% !important;
  height:auto !important; border-radius:.75rem !important;
}
/* Beat inline width/height on non-floated images */
.wysiwyg :is(img[width],img[height],img[style*="width"]):not(
  .alignleft,.alignright,.ws-float-left,.ws-float-right,
  [style*="float:left"],[style*="float: left"],
  [style*="float:right"],[style*="float: right"]
){
  width:50% !important; max-width:50% !important; height:auto !important;
}

/* Floats (left/right) */
.wysiwyg img.alignleft,
.wysiwyg .alignleft>img,
.wysiwyg img.ws-float-left,
.wysiwyg img[style*="float:left"],
.wysiwyg img[style*="float: left"]{
  float:left; margin:6px 16px 6px 0; shape-outside:inset(0 round 12px);
}
.wysiwyg img.alignright,
.wysiwyg .alignright>img,
.wysiwyg img.ws-float-right,
.wysiwyg img[style*="float:right"],
.wysiwyg img[style*="float: right"]{
  float:right; margin:6px 0 6px 16px; shape-outside:inset(0 round 12px);
}

/* Do NOT shrink images inside FloatAd cards */
.wysiwyg a[data-floatkey] img,
.wysiwyg .floatad img{
  width:100% !important; max-width:none !important; height:100% !important;
  margin:0 !important; border-radius:0 !important;
}

/* Remove inner width clamps so text wraps around floats cleanly */
.wysiwyg :where(
  .prose,.container,.ql-editor,.ql-container,
  .editor-content,.content,.post-body,.article
){
  max-width:none !important; width:auto !important;
  margin-left:0 !important; margin-right:0 !important;
  padding-left:0 !important; padding-right:0 !important;
}
/* Kill common inline clamps */
.wysiwyg :where([style*="max-width"],[style*="width"],[style*="margin:0 auto"],[style*="margin: 0 auto"]){
  max-width:100% !important; width:auto !important; margin-left:0 !important; margin-right:0 !important;
}

/* ----------- SAFE CONTAINER GUARDS ----------- */
.wysiwyg > *{ max-width:100% !important; overflow-x: clip; }
.wysiwyg :is(figure,picture){ max-width:100% !important; width:100% !important; overflow-x: clip; }
.wysiwyg table{ display:block; max-width:100%; width:100%; overflow-x:auto; }
.wysiwyg :is(figure,picture) img{ width:100% !important; max-width:100% !important; height:auto !important; }

/* Mobile: full-width images, no floats */
@media (max-width:768px){
  .wysiwyg :is(img,a>img,figure>img),
  .wysiwyg :is(img[width],img[height],img[style*="width"]){
    width:100% !important; max-width:100% !important;
  }
  .wysiwyg img.alignleft,
  .wysiwyg .alignleft>img,
  .wysiwyg img.alignright,
  .wysiwyg .alignright>img,
  .wysiwyg img.ws-float-left,
  .wysiwyg img.ws-float-right,
  .wysiwyg img[style*="float:left"],
  .wysiwyg img[style*="float: left"],
  .wysiwyg img[style*="float:right"],
  .wysiwyg img[style*="float: right"]{
    float:none !important; margin:1.1em 0 !important; width:100% !important; max-width:100% !important;
  }
}

/* ---------------- FloatAd hover overlay (DRY) --------- */
:is(.floatad,a[data-floatkey]){ position:relative; }
:is(.floatad,a[data-floatkey]) .floatad__overlay{
  position:absolute; inset:0; display:flex; align-items:center; justify-content:center;
  opacity:0; background-color:transparent; transition:opacity .15s ease, background-color .15s ease;
  pointer-events:none;
}
:is(.floatad,a[data-floatkey]):where(:hover,:focus-visible,:active) .floatad__overlay{
  opacity:1; background-color:rgba(0,0,0,.30);
}
@media (max-width:768px){
  :is(.floatad, a[data-floatkey]){
    float:none !important;
    width:100% !important;
    margin:12px 0 !important;
    shape-outside:none !important;

    /* Kill any accidental positioning that could cause overflow */
    position:static !important;
    left:auto !important;
    right:auto !important;
    transform:none !important;
  }
}
:is(.floatad,a[data-floatkey]) + .wysiwyg{ margin-top:8px; }

/* ---------------- Misc ---------------- */
.adbay-rule{
  border:0; height:0;
  border-top:1px solid color-mix(in oklab,currentColor 20%,transparent);
  margin:1.75em 0; display:block;
}

/* Kill Next dev overlay width on iOS (dev only) */
[id^="nextjs"], [data-nextjs-dialog], [data-nextjs-toast], [id^="__next-build"]{
  max-width: 100vw !important;
  overflow-x: clip !important;
}
@media (max-width: 900px){
  [data-nextjs-toast]{ display:none !important; }
}

/* Root should never exceed the visual viewport on iOS */
html, body, #__next, #viewport-clamp { max-width: 100svw; overflow-x: clip; }
@supports not (overflow-x: clip) { html, body, #__next, #viewport-clamp { overflow-x: hidden; } }

/* Defensive: elements that try to use viewport units inside padded containers */
.w-screen,
.min-w-screen,
[style*="width:100vw"],
[style*="width: 100vw"],
[style*="min-width:100vw"],
[style*="min-width: 100vw"]{
  max-width: 100% !important;
  width: 100% !important;
}
/* Scope the same clamp to anything inside our site container */
.ws-container :is(.w-screen,.min-w-screen,[style*="width:100vw"],[style*="min-width:100vw"]){
  max-width:100% !important;
  width:100% !important;
}

/* FINAL MOBILE GUARD: nothing inside the content column can exceed it */
@media (max-width: 768px){
  .ws-container,
  .ws-article,
  main, header, footer { overflow-x: clip !important; }
  .ws-container * { max-inline-size: 100% !important; }
}

/* Global media guard */
img, svg, video, canvas { max-width: 100%; height: auto; }

/* ---------------- Admin shell ---------------- */
.admin-card{
  border:1px solid color-mix(in oklab,currentColor 18%,transparent);
  border-radius:1rem;
  background:
    radial-gradient(120% 90% at 0% 0%, color-mix(in oklab,currentColor 10%,transparent), transparent 60%),
    color-mix(in oklab,var(--background) 86%, var(--foreground) 14%);
}

.admin-surface{
  border:1px solid color-mix(in oklab,currentColor 16%,transparent);
  background:color-mix(in oklab,var(--background) 92%, var(--foreground) 8%);
}
